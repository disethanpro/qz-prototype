<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P8 - å†å²è®°å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #E8EAED;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ä¸»çª—å£å®¹å™¨ */
        .main-window {
            width: 1920px;
            height: 1080px;
            display: flex;
            flex-direction: column;
            background-color: #E8EAED;
            transform-origin: center center;
        }

        /* è‡ªåŠ¨ç¼©æ”¾ */
        @media screen {
            .main-window {
                transform: scale(var(--scale, 1));
            }
        }

        /* ========== é¡¶éƒ¨æ  ========== */
        .top-bar {
            background: linear-gradient(to bottom, #4A5568, #3A4558);
            color: #FFFFFF;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }

        .top-bar-left {
            font-size: 20px;
            font-weight: bold;
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .user-info:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .user-role {
            font-size: 14px;
        }

        .user-dropdown {
            position: absolute;
            top: 45px;
            right: 0;
            background-color: #FFFFFF;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 180px;
            display: none;
            z-index: 1000;
        }

        .user-dropdown.show {
            display: block;
            animation: fadeInDown 0.2s;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-item {
            padding: 12px 20px;
            color: #2D3748;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .dropdown-item:first-child {
            border-radius: 6px 6px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 6px 6px;
        }

        .dropdown-item:hover {
            background-color: #F7FAFC;
        }

        .dropdown-divider {
            height: 1px;
            background-color: #E2E8F0;
            margin: 5px 0;
        }

        /* ========== è¿”å›æŒ‰é’®åŒº ========== */
        .nav-bar {
            background-color: #FFFFFF;
            padding: 15px 30px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            gap: 12px;
        }

        .btn-back {
            padding: 8px 20px;
            font-size: 14px;
            background-color: #E2E8F0;
            color: #2D3748;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .btn-back:hover {
            background-color: #CBD5E0;
        }

        /* ========== ä¸»å†…å®¹åŒº ========== */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .content-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }

        .content-left.drawer-open {
            /* ä¸æ”¹å˜å·¦ä¾§å®½åº¦ï¼Œè®©æŠ½å±‰è¦†ç›–åœ¨ä¸Šé¢ */
        }

        /* ========== ç®¡ç†å‘˜å·¥å…·æ  ========== */
        .admin-toolbar {
            background-color: #FFFFFF;
            padding: 15px 30px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-toolbar.hidden {
            display: none;
        }

        .checkbox-all {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* ========== ç­›é€‰åŒº ========== */
        .filter-section {
            background-color: #FFFFFF;
            padding: 20px 30px;
            border-bottom: 1px solid #E2E8F0;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 13px;
            color: #4A5568;
            font-weight: 600;
        }

        .filter-input,
        .filter-select {
            height: 38px;
            padding: 0 12px;
            font-size: 14px;
            border: 1px solid #CBD5E0;
            border-radius: 4px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .filter-input:focus,
        .filter-select:focus {
            outline: none;
            border-color: #4299E1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            grid-column: span 5;
        }

        .btn {
            padding: 10px 30px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #48BB78;
            color: #FFFFFF;
        }

        .btn-primary:hover {
            background-color: #38A169;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .btn-secondary {
            background-color: #E2E8F0;
            color: #2D3748;
        }

        .btn-secondary:hover {
            background-color: #CBD5E0;
        }

        .btn-danger {
            background-color: #E53E3E;
            color: #FFFFFF;
        }

        .btn-danger:hover {
            background-color: #C53030;
            box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
        }

        /* ========== è¡¨æ ¼åŒº ========== */
        .table-container {
            flex: 1;
            overflow: auto;
            padding: 0;
            background-color: #FFFFFF;
        }

        .data-table {
            width: 100%;
            background-color: #FFFFFF;
            border-collapse: collapse;
        }

        .data-table thead {
            background-color: #F7FAFC;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            color: #2D3748;
            border-bottom: 2px solid #E2E8F0;
        }

        .data-table th.checkbox-col {
            width: 50px;
            text-align: center;
        }

        .data-table td {
            padding: 15px;
            font-size: 14px;
            color: #4A5568;
            border-bottom: 1px solid #E2E8F0;
        }

        .data-table tbody tr {
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .data-table tbody tr:hover {
            background-color: #F7FAFC;
        }

        .data-table tbody tr.selected {
            background-color: #EBF8FF;
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-success {
            background-color: #C6F6D5;
            color: #22543D;
        }

        .badge-danger {
            background-color: #FED7D7;
            color: #742A2A;
        }

        .badge-info {
            background-color: #BEE3F8;
            color: #2C5282;
        }

        .badge-secondary {
            background-color: #E2E8F0;
            color: #4A5568;
        }

        .badge-warning {
            background-color: #FEEBC8;
            color: #7C2D12;
        }

        /* ========== è¯¦æƒ…æŠ½å±‰ ========== */
        .detail-drawer {
            position: absolute;
            top: 0;
            right: 0;
            width: 768px; /* 40% of 1920px */
            height: 100%;
            background-color: #FFFFFF;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 500;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .detail-drawer.show {
            transform: translateX(0);
        }

        .drawer-header {
            padding: 20px 30px;
            border-bottom: 1px solid #E2E8F0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drawer-title {
            font-size: 18px;
            font-weight: bold;
            color: #2D3748;
        }

        .drawer-actions {
            display: flex;
            gap: 10px;
        }

        .drawer-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .info-section {
            margin-bottom: 30px;
        }

        .info-title {
            font-size: 16px;
            font-weight: bold;
            color: #2D3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #E2E8F0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-size: 13px;
            color: #718096;
        }

        .info-value {
            font-size: 14px;
            color: #2D3748;
            font-weight: 600;
        }

        .result-table {
            width: 100%;
            border: 1px solid #E2E8F0;
            border-radius: 4px;
            margin-top: 15px;
        }

        .result-table th,
        .result-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #E2E8F0;
            font-size: 13px;
        }

        .result-table th {
            background-color: #F7FAFC;
            font-weight: 600;
            color: #2D3748;
        }

        .drawer-footer {
            padding: 15px 30px;
            border-top: 1px solid #E2E8F0;
            display: flex;
            justify-content: flex-end;
        }

        /* ========== åº•éƒ¨çŠ¶æ€æ  ========== */
        .bottom-bar {
            background-color: #2D3748;
            color: #FFFFFF;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            font-size: 13px;
        }

        .status-group {
            display: flex;
            gap: 30px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-label {
            color: #A0AEC0;
        }

        .status-value {
            font-weight: bold;
        }

        /* ========== é®ç½© ========== */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 400;
            display: none;
            animation: fadeIn 0.2s;
        }

        .overlay.show {
            display: block;
        }

        /* ========== æ¨¡æ€å¼¹çª— ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.2s;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background-color: #FFFFFF;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            width: 500px;
            max-height: 80vh;
            overflow: hidden;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(to bottom, #4A5568, #3A4558);
            color: #FFFFFF;
            padding: 18px 25px;
            font-size: 17px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close-btn {
            background: none;
            border: none;
            color: #FFFFFF;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .modal-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 25px;
            max-height: calc(80vh - 150px);
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #2D3748;
            margin-bottom: 10px;
            display: block;
        }

        .form-label.required::after {
            content: " *";
            color: #E53E3E;
        }

        .password-input {
            width: 100%;
            height: 40px;
            padding: 0 12px;
            font-size: 14px;
            border: 1px solid #CBD5E0;
            border-radius: 4px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .password-input:focus {
            outline: none;
            border-color: #4299E1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .password-input.error {
            border-color: #E53E3E;
        }

        .error-message {
            font-size: 12px;
            color: #E53E3E;
            margin-top: 8px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .info-box {
            background-color: #EBF8FF;
            border-left: 4px solid #4299E1;
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .info-box-text {
            font-size: 13px;
            color: #2C5282;
            line-height: 1.6;
        }

        .warning-box {
            background-color: #FFF5F5;
            border-left: 4px solid #E53E3E;
            padding: 12px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .warning-box-text {
            font-size: 13px;
            color: #742A2A;
            line-height: 1.6;
        }

        .modal-footer {
            background-color: #F7FAFC;
            padding: 15px 25px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-top: 1px solid #E2E8F0;
        }

        .modal-btn {
            padding: 10px 30px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* ========== å…¨å±€æç¤º ========== */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            font-size: 15px;
            font-weight: bold;
            display: none;
            z-index: 3000;
            animation: slideDownToast 0.3s;
        }

        @keyframes slideDownToast {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            background-color: #48BB78;
            color: #FFFFFF;
        }

        .toast.error {
            background-color: #E53E3E;
            color: #FFFFFF;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state-text {
            font-size: 16px;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #F7FAFC;
        }

        ::-webkit-scrollbar-thumb {
            background: #CBD5E0;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #A0AEC0;
        }

        /* åˆ†é¡µå™¨ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px 0;
            background-color: #FFFFFF;
            border-top: 1px solid #E2E8F0;
        }

        .pagination-btn {
            padding: 8px 15px;
            font-size: 14px;
            background-color: #FFFFFF;
            color: #2D3748;
            border: 1px solid #CBD5E0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: #E2E8F0;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background-color: #4299E1;
            color: #FFFFFF;
            border-color: #4299E1;
        }

        .pagination-info {
            font-size: 14px;
            color: #4A5568;
        }

        /* å¯¼å‡ºèŒƒå›´é€‰æ‹© */
        .radio-group {
            display: flex;
            gap: 25px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-option label {
            font-size: 14px;
            color: #4A5568;
            cursor: pointer;
        }

        .directory-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .directory-path {
            flex: 1;
            height: 38px;
            padding: 0 12px;
            font-size: 13px;
            color: #4A5568;
            background-color: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .directory-btn {
            padding: 8px 18px;
            font-size: 13px;
            font-weight: 600;
            background-color: #4299E1;
            color: #FFFFFF;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .directory-btn:hover {
            background-color: #3182CE;
        }

        .filename-preview {
            background-color: #F7FAFC;
            border: 1px dashed #CBD5E0;
            border-radius: 4px;
            padding: 12px 15px;
            margin-top: 8px;
        }

        .filename-example {
            font-size: 13px;
            color: #4A5568;
            margin-bottom: 5px;
            font-family: "Consolas", "Monaco", monospace;
        }

        .filename-hint {
            font-size: 12px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="main-window">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <div class="top-bar-left">
                æ›²è½´è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿ â€“ å†å²è®°å½•
            </div>
            <div class="top-bar-right">
                <div class="user-info" onclick="toggleUserDropdown(event)">
                    <span class="user-role" id="userRoleDisplay">å½“å‰è§’è‰²ï¼šæ“ä½œå‘˜</span>
                    <span>â–¼</span>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="event.stopPropagation(); openChangePasswordModal()">ä¿®æ”¹å¯†ç â€¦</div>
                        <div class="dropdown-item" onclick="event.stopPropagation(); lockScreen()">é”å±</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="event.stopPropagation(); openLogoutModal()">é€€å‡ºç™»å½•â€¦</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿”å›æŒ‰é’®åŒº -->
        <div class="nav-bar">
            <button class="btn-back" id="backBtn" onclick="goBack()">è¿”å›é¦–é¡µ</button>
        </div>

        <!-- ç®¡ç†å‘˜å·¥å…·æ  -->
        <div class="admin-toolbar" id="adminToolbar">
            <input type="checkbox" class="checkbox-all" id="checkboxAll" onchange="toggleSelectAll()">
            <label for="checkboxAll" style="cursor: pointer; font-size: 14px; color: #4A5568;">å…¨é€‰</label>
            <button class="btn btn-primary" onclick="batchExport()" id="batchExportBtn" disabled>æ‰¹é‡å¯¼å‡ºæŠ¥è¡¨</button>
            <button class="btn btn-danger" onclick="openBatchDeleteModal()" id="batchDeleteBtn" disabled>æ‰¹é‡åˆ é™¤è®°å½•</button>
            <span style="margin-left: auto; font-size: 14px; color: #718096;" id="selectedCount">å·²é€‰æ‹© 0 æ¡</span>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="content-left" id="contentLeft">
                <!-- ç­›é€‰åŒº -->
                <div class="filter-section">
                    <div class="filter-row">
                        <div class="filter-item">
                            <label class="filter-label">èµ·å§‹æ—¥æœŸ</label>
                            <input type="date" class="filter-input" id="startDate">
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">ç»“æŸæ—¥æœŸ</label>
                            <input type="date" class="filter-input" id="endDate">
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">å‹å·</label>
                            <select class="filter-select" id="modelFilter">
                                <option value="">å…¨éƒ¨</option>
                                <option value="DF8B">DF8B</option>
                                <option value="HXN5B">HXN5B</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">æ›²è½´ç¼–å·</label>
                            <input type="text" class="filter-input" id="shaftIdFilter" placeholder="è¾“å…¥ç¼–å·">
                        </div>
                        <div class="filter-item">
                            <label class="filter-label">åˆ¤å®šç»“æœ</label>
                            <select class="filter-select" id="resultFilter">
                                <option value="">å…¨éƒ¨</option>
                                <option value="åˆæ ¼">åˆæ ¼</option>
                                <option value="ä¸åˆæ ¼">ä¸åˆæ ¼</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-item">
                            <label class="filter-label">å¯¼å‡ºçŠ¶æ€</label>
                            <select class="filter-select" id="exportFilter">
                                <option value="">å…¨éƒ¨</option>
                                <option value="å·²å¯¼å‡º">å·²å¯¼å‡º</option>
                                <option value="æœªå¯¼å‡º">æœªå¯¼å‡º</option>
                            </select>
                        </div>
                        <div class="filter-buttons" style="grid-column: span 4; display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="applyFilters()">æŸ¥è¯¢</button>
                            <button class="btn btn-secondary" onclick="resetFilters()">é‡ç½®ç­›é€‰</button>
                        </div>
                    </div>
                </div>

                <!-- è¡¨æ ¼åŒº -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="checkbox-col" id="checkboxHeader" style="display: none;">
                                    <input type="checkbox" onchange="toggleSelectAll()">
                                </th>
                                <th>æ—¥æœŸæ—¶é—´</th>
                                <th>å‹å·</th>
                                <th>æ›²è½´ç¼–å·</th>
                                <th>æ£€æµ‹è½®æ¬¡</th>
                                <th>æ•´ä½“åˆ¤å®š</th>
                                <th>å¯¼å‡ºçŠ¶æ€</th>
                                <th>æ£€æµ‹çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- æ•°æ®å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>

                    <!-- åˆ†é¡µå™¨ -->
                    <div class="pagination" id="pagination">
                        <button class="pagination-btn" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
                        <span class="pagination-info" id="pageInfo">ç¬¬ 1 é¡µ / å…± 5 é¡µ</span>
                        <button class="pagination-btn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
                    </div>
                </div>
            </div>

            <!-- è¯¦æƒ…æŠ½å±‰ -->
            <div class="detail-drawer" id="detailDrawer">
                <div class="drawer-header">
                    <div class="drawer-title">æ£€æµ‹è®°å½•è¯¦æƒ…</div>
                    <div class="drawer-actions">
                        <button class="btn btn-primary" onclick="exportRecord()">å¯¼å‡ºæŠ¥è¡¨</button>
                        <button class="btn btn-danger" id="deleteRecordBtn" onclick="openDeleteRecordModal()" style="display: none;">åˆ é™¤è®°å½•</button>
                        <button class="btn btn-secondary" onclick="closeDrawer()">å…³é—­</button>
                    </div>
                </div>
                <div class="drawer-body" id="drawerBody">
                    <!-- è¯¦æƒ…å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <div class="bottom-bar">
            <div class="status-group">
                <div class="status-item">
                    <span class="status-label">å½“å‰è§’è‰²ï¼š</span>
                    <span class="status-value" id="currentRole">æ“ä½œå‘˜</span>
                </div>
                <div class="status-item">
                    <span class="status-label">è‡ªæ£€çŠ¶æ€ï¼š</span>
                    <span class="status-value" style="color: #48BB78;">æ­£å¸¸</span>
                </div>
            </div>
            <div class="status-item">
                <span class="status-label">å½“å‰æ—¶é—´ï¼š</span>
                <span class="status-value" id="currentTime">2025-11-12 17:30:45</span>
            </div>
        </div>

        <!-- æŠ½å±‰é®ç½© -->
        <div class="overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
    </div>

    <!-- å¯¼å‡ºå¼¹çª— -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <span>å¯¼å‡ºæ£€æµ‹æŠ¥è¡¨</span>
                <button class="modal-close-btn" onclick="closeExportModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="info-box" id="exportInfo" style="display: none;">
                    <div class="info-box-text" id="exportInfoText">
                        å·²é€‰ä¸­ <strong>3</strong> æ¡è®°å½•ï¼Œå°†æ‰¹é‡å¯¼å‡ºä¸ºç‹¬ç«‹æ–‡ä»¶
                    </div>
                </div>

                <div class="form-group" id="exportRangeGroup">
                    <label class="form-label">å¯¼å‡ºèŒƒå›´</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="rangeCurrent" name="exportRange" value="current" checked>
                            <label for="rangeCurrent">å½“å‰è®°å½•</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="rangeSelected" name="exportRange" value="selected">
                            <label for="rangeSelected">å·²å‹¾é€‰è®°å½•</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">å¯¼å‡ºç›®å½•</label>
                    <div class="directory-selector">
                        <div class="directory-path" id="exportDirectory">
                            C:\Users\Public\Documents\æ›²è½´æ£€æµ‹æŠ¥è¡¨
                        </div>
                        <button class="directory-btn" onclick="selectDirectory()">æ›´æ”¹ç›®å½•</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">æ–‡ä»¶å‘½åè§„åˆ™</label>
                    <div class="filename-preview">
                        <div class="filename-example" id="filenameExample">
                            ç¤ºä¾‹ï¼šHXN5B_QZ0003_ç¬¬2è½®_20251112_173045.xlsx
                        </div>
                        <div class="filename-hint">å¯¼å‡ºåå¯åœ¨ç›®å½•ä¸­æŸ¥çœ‹</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">è¯·è¾“å…¥å¯†ç ä»¥ç¡®è®¤å¯¼å‡º</label>
                    <input 
                        type="password" 
                        class="password-input" 
                        id="exportPassword" 
                        placeholder="æ“ä½œå‘˜è¾“å…¥æœ¬äººå¯†ç ï¼Œç®¡ç†å‘˜è¾“å…¥ç®¡ç†å‘˜å¯†ç "
                        autocomplete="off">
                    <div class="error-message" id="exportPasswordError">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" onclick="closeExportModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-primary" onclick="confirmExport()">ç¡®è®¤å¯¼å‡º</button>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="batchDeleteModal">
        <div class="modal">
            <div class="modal-header">
                <span>æ‰¹é‡åˆ é™¤è®°å½•</span>
                <button class="modal-close-btn" onclick="closeBatchDeleteModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="warning-box">
                    <div class="warning-box-text">
                        <strong>è­¦å‘Šï¼š</strong>æ‚¨å³å°†åˆ é™¤ <strong id="deleteCount">3</strong> æ¡æ£€æµ‹è®°å½•ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥ç¡®è®¤åˆ é™¤</label>
                    <input 
                        type="password" 
                        class="password-input" 
                        id="deletePassword" 
                        placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç "
                        autocomplete="off">
                    <div class="error-message" id="deletePasswordError">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" onclick="closeBatchDeleteModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-danger" onclick="confirmBatchDelete()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- å•æ¡åˆ é™¤ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="deleteRecordModal">
        <div class="modal">
            <div class="modal-header">
                <span>åˆ é™¤è®°å½•</span>
                <button class="modal-close-btn" onclick="closeDeleteRecordModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="warning-box">
                    <div class="warning-box-text">
                        <strong>è­¦å‘Šï¼š</strong>æ‚¨å³å°†åˆ é™¤æ­¤æ£€æµ‹è®°å½•ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label required">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥ç¡®è®¤åˆ é™¤</label>
                    <input 
                        type="password" 
                        class="password-input" 
                        id="singleDeletePassword" 
                        placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç "
                        autocomplete="off">
                    <div class="error-message" id="singleDeletePasswordError">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" onclick="closeDeleteRecordModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-danger" onclick="confirmDeleteRecord()">ç¡®è®¤åˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- é€€å‡ºç™»å½•ç¡®è®¤å¼¹çª— -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal">
            <div class="modal-header">
                <span>é€€å‡ºç™»å½•</span>
                <button class="modal-close-btn" onclick="closeLogoutModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="info-box">
                    <div class="info-box-text">
                        ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿé€€å‡ºåéœ€è¦é‡æ–°è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" onclick="closeLogoutModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-danger" onclick="confirmLogout()">ç¡®è®¤é€€å‡º</button>
            </div>
        </div>
    </div>

    <!-- ä¿®æ”¹å¯†ç å¼¹çª— -->
    <div class="modal-overlay" id="changePasswordModal">
        <div class="modal">
            <div class="modal-header">
                <span>ä¿®æ”¹å¯†ç </span>
                <button class="modal-close-btn" onclick="closeChangePasswordModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label required">å½“å‰å¯†ç </label>
                    <input type="password" class="password-input" id="oldPassword" placeholder="è¾“å…¥å½“å‰å¯†ç " autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label required">æ–°å¯†ç </label>
                    <input type="password" class="password-input" id="newPassword" placeholder="è¾“å…¥æ–°å¯†ç " autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label required">ç¡®è®¤æ–°å¯†ç </label>
                    <input type="password" class="password-input" id="confirmPassword" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " autocomplete="off">
                    <div class="error-message" id="changePasswordError">ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" onclick="closeChangePasswordModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-primary" onclick="confirmChangePassword()">ç¡®è®¤ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <!-- å…¨å±€æç¤º -->
    <div class="toast success" id="successToast"></div>
    <div class="toast error" id="errorToast"></div>

    <script>
        // ==================== è‡ªåŠ¨ç¼©æ”¾ ====================
        function autoScale() {
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const designWidth = 1920;
            const designHeight = 1080;
            
            const scaleX = windowWidth / designWidth;
            const scaleY = windowHeight / designHeight;
            const scale = Math.min(scaleX, scaleY, 1);
            
            document.documentElement.style.setProperty('--scale', scale);
        }

        window.addEventListener('load', autoScale);
        window.addEventListener('resize', autoScale);

        // ==================== å…¨å±€çŠ¶æ€ ====================
        const appState = {
            userRole: 'operator', // 'operator' æˆ– 'admin'
            selectedRecords: new Set(),
            currentRecord: null,
            currentPage: 1,
            totalPages: 5,
            pageSize: 20,
            allRecords: [],
            filteredRecords: []
        };

        // ==================== æ¨¡æ‹Ÿæ•°æ® ====================
        function generateMockData() {
            const data = [];
            const models = ['DF8B', 'HXN5B'];
            const results = ['åˆæ ¼', 'ä¸åˆæ ¼'];
            const exportStatus = ['å·²å¯¼å‡º', 'æœªå¯¼å‡º'];
            const detectStatus = ['å·²å®Œæˆ', 'æ£€æµ‹ä¸­æ–­'];

            for (let i = 1; i <= 50; i++) {
                const date = new Date(2025, 10, Math.floor(Math.random() * 12) + 1, Math.floor(Math.random() * 24), Math.floor(Math.random() * 60));
                data.push({
                    id: i,
                    datetime: date.toLocaleString('zh-CN', { hour12: false }),
                    model: models[Math.floor(Math.random() * models.length)],
                    shaftId: `QZ${String(i).padStart(4, '0')}`,
                    round: Math.floor(Math.random() * 3) + 1,
                    result: results[Math.floor(Math.random() * results.length)],
                    exported: exportStatus[Math.floor(Math.random() * exportStatus.length)],
                    status: detectStatus[Math.floor(Math.random() * 10) > 8 ? 1 : 0],
                    operator: 'å¼ ä¸‰',
                    // æ¨¡æ‹Ÿä¸‰é¡¹æ£€æµ‹æ•°æ®
                    vibrationData: generateVibrationData(models[0] === 'DF8B' ? 9 : 7),
                    roughnessData: generateRoughnessData(models[0] === 'DF8B' ? 9 : 7),
                    diameterData: generateDiameterData(models[0] === 'DF8B' ? 9 : 7)
                });
            }
            return data;
        }

        function generateVibrationData(count) {
            const data = [];
            for (let i = 1; i <= count; i++) {
                data.push({
                    id: i,
                    value: (Math.random() * 0.05).toFixed(3),
                    result: Math.random() > 0.2 ? 'åˆæ ¼' : 'ä¸åˆæ ¼'
                });
            }
            return data;
        }

        function generateRoughnessData(count) {
            const data = [];
            for (let i = 1; i <= count; i++) {
                data.push({
                    id: i,
                    value: (Math.random() * 0.3).toFixed(3),
                    result: Math.random() > 0.15 ? 'åˆæ ¼' : 'ä¸åˆæ ¼'
                });
            }
            return data;
        }

        function generateDiameterData(count) {
            const data = [];
            for (let i = 1; i <= count; i++) {
                const sensor1 = (Math.random() * 0.1 + 49.9).toFixed(3);
                const sensor2 = (Math.random() * 0.1 + 49.9).toFixed(3);
                data.push({
                    id: i,
                    sensor1: sensor1,
                    sensor2: sensor2,
                    diff: (Math.abs(sensor1 - sensor2)).toFixed(3),
                    result: Math.random() > 0.1 ? 'åˆæ ¼' : 'ä¸åˆæ ¼'
                });
            }
            return data;
        }

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
            appState.allRecords = generateMockData();
            appState.filteredRecords = [...appState.allRecords];

            // æ ¹æ®è§’è‰²è°ƒæ•´ç•Œé¢
            const role = appState.userRole;
            updateUIForRole(role);

            // æ¸²æŸ“è¡¨æ ¼
            renderTable();

            // æ›´æ–°æ—¶é—´
            updateTime();
            setInterval(updateTime, 1000);

            // è®¾ç½®é»˜è®¤æ—¥æœŸèŒƒå›´ï¼ˆæœ€è¿‘ä¸€ä¸ªæœˆï¼‰
            const today = new Date();
            const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            document.getElementById('endDate').valueAsDate = today;
            document.getElementById('startDate').valueAsDate = lastMonth;
        }

        function updateUIForRole(role) {
            const isAdmin = role === 'admin';
            
            // æ›´æ–°è§’è‰²æ˜¾ç¤º
            document.getElementById('userRoleDisplay').textContent = `å½“å‰è§’è‰²ï¼š${isAdmin ? 'ç®¡ç†å‘˜' : 'æ“ä½œå‘˜'}`;
            document.getElementById('currentRole').textContent = isAdmin ? 'ç®¡ç†å‘˜' : 'æ“ä½œå‘˜';
            
            // æ›´æ–°è¿”å›æŒ‰é’®æ–‡å­—
            document.getElementById('backBtn').textContent = isAdmin ? 'è¿”å›é…ç½®é¡µ' : 'è¿”å›é¦–é¡µ';
            
            // æ˜¾ç¤º/éšè—ç®¡ç†å‘˜å·¥å…·æ 
            document.getElementById('adminToolbar').classList.toggle('hidden', !isAdmin);
            
            // æ˜¾ç¤º/éšè—å¤é€‰æ¡†åˆ—
            document.getElementById('checkboxHeader').style.display = isAdmin ? '' : 'none';
            
            // æ˜¾ç¤º/éšè—åˆ é™¤æŒ‰é’®
            document.getElementById('deleteRecordBtn').style.display = isAdmin ? '' : 'none';
            
            // å¦‚æœæ˜¯æ“ä½œå‘˜ï¼Œè¿‡æ»¤åªæ˜¾ç¤ºæœ¬äººè®°å½•
            if (!isAdmin) {
                appState.filteredRecords = appState.allRecords.filter(r => r.operator === 'å¼ ä¸‰');
            }
        }

        // ==================== è¡¨æ ¼æ¸²æŸ“ ====================
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const start = (appState.currentPage - 1) * appState.pageSize;
            const end = start + appState.pageSize;
            const pageData = appState.filteredRecords.slice(start, end);

            if (pageData.length === 0) {
                const colSpan = appState.userRole === 'admin' ? 8 : 7;
                tbody.innerHTML = `
                    <tr>
                        <td colspan="${colSpan}" style="text-align: center; padding: 60px 20px;">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“­</div>
                                <div class="empty-state-text">æš‚æ— æ£€æµ‹è®°å½•</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = pageData.map(record => {
                const isSelected = appState.selectedRecords.has(record.id);
                const checkboxCol = appState.userRole === 'admin' ? 
                    `<td onclick="event.stopPropagation()"><input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSelectRecord(${record.id}, event)"></td>` : '';
                
                return `
                    <tr class="${isSelected ? 'selected' : ''}" onclick="openDrawer(${record.id}, event)" data-id="${record.id}">
                        ${checkboxCol}
                        <td>${record.datetime}</td>
                        <td>${record.model}</td>
                        <td>${record.shaftId}</td>
                        <td>ç¬¬${record.round}è½®</td>
                        <td><span class="badge ${record.result === 'åˆæ ¼' ? 'badge-success' : 'badge-danger'}">${record.result}</span></td>
                        <td><span class="badge ${record.exported === 'å·²å¯¼å‡º' ? 'badge-info' : 'badge-secondary'}">${record.exported}</span></td>
                        <td><span class="badge ${record.status === 'å·²å®Œæˆ' ? 'badge-success' : 'badge-warning'}">${record.status}</span></td>
                    </tr>
                `;
            }).join('');

            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            appState.totalPages = Math.ceil(appState.filteredRecords.length / appState.pageSize);
            document.getElementById('pageInfo').textContent = `ç¬¬ ${appState.currentPage} é¡µ / å…± ${appState.totalPages} é¡µ`;
            
            // æ›´æ–°é€‰ä¸­è®¡æ•°
            updateSelectedCount();
        }

        // ==================== ç­›é€‰åŠŸèƒ½ ====================
        function applyFilters() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const model = document.getElementById('modelFilter').value;
            const shaftId = document.getElementById('shaftIdFilter').value.trim();
            const result = document.getElementById('resultFilter').value;
            const exported = document.getElementById('exportFilter').value;

            appState.filteredRecords = appState.allRecords.filter(record => {
                // æ—¥æœŸç­›é€‰
                if (startDate && record.datetime < startDate) return false;
                if (endDate && record.datetime > endDate + ' 23:59:59') return false;
                
                // å‹å·ç­›é€‰
                if (model && record.model !== model) return false;
                
                // ç¼–å·ç­›é€‰
                if (shaftId && !record.shaftId.includes(shaftId)) return false;
                
                // ç»“æœç­›é€‰
                if (result && record.result !== result) return false;
                
                // å¯¼å‡ºçŠ¶æ€ç­›é€‰
                if (exported && record.exported !== exported) return false;
                
                // æ“ä½œå‘˜åªèƒ½çœ‹è‡ªå·±çš„è®°å½•
                if (appState.userRole === 'operator' && record.operator !== 'å¼ ä¸‰') return false;
                
                return true;
            });

            appState.currentPage = 1;
            renderTable();
            showToast('âœ“ ç­›é€‰æ¡ä»¶å·²åº”ç”¨', 'success');
        }

        function resetFilters() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('shaftIdFilter').value = '';
            document.getElementById('resultFilter').value = '';
            document.getElementById('exportFilter').value = '';
            
            appState.filteredRecords = appState.userRole === 'operator' 
                ? appState.allRecords.filter(r => r.operator === 'å¼ ä¸‰')
                : [...appState.allRecords];
            
            appState.currentPage = 1;
            renderTable();
            showToast('âœ“ ç­›é€‰æ¡ä»¶å·²é‡ç½®', 'success');
        }

        // ==================== åˆ†é¡µåŠŸèƒ½ ====================
        function changePage(delta) {
            const newPage = appState.currentPage + delta;
            if (newPage < 1 || newPage > appState.totalPages) return;
            
            appState.currentPage = newPage;
            renderTable();
        }

        // ==================== é€‰æ‹©åŠŸèƒ½ ====================
        function toggleSelectAll() {
            const checked = document.getElementById('checkboxAll').checked;
            const start = (appState.currentPage - 1) * appState.pageSize;
            const end = start + appState.pageSize;
            const pageData = appState.filteredRecords.slice(start, end);
            
            if (checked) {
                pageData.forEach(record => appState.selectedRecords.add(record.id));
            } else {
                pageData.forEach(record => appState.selectedRecords.delete(record.id));
            }
            
            renderTable();
            updateBatchButtons();
        }

        function toggleSelectRecord(id, e) {
            if (e) e.stopPropagation();
            
            if (appState.selectedRecords.has(id)) {
                appState.selectedRecords.delete(id);
            } else {
                appState.selectedRecords.add(id);
            }
            
            renderTable();
            updateBatchButtons();
        }

        function updateSelectedCount() {
            const count = appState.selectedRecords.size;
            document.getElementById('selectedCount').textContent = `å·²é€‰æ‹© ${count} æ¡`;
        }

        function updateBatchButtons() {
            const count = appState.selectedRecords.size;
            document.getElementById('batchExportBtn').disabled = count === 0;
            document.getElementById('batchDeleteBtn').disabled = count === 0;
            updateSelectedCount();
        }

        // ==================== æŠ½å±‰åŠŸèƒ½ ====================
        function openDrawer(id, e) {
            console.log('openDrawer è¢«è°ƒç”¨, ID:', id);
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼ˆå¦‚æœç‚¹å‡»çš„æ˜¯å¤é€‰æ¡†ï¼‰
            if (e && e.target.type === 'checkbox') {
                console.log('ç‚¹å‡»äº†å¤é€‰æ¡†ï¼Œé˜»æ­¢æ‰“å¼€æŠ½å±‰');
                e.stopPropagation();
                return;
            }
            
            const record = appState.allRecords.find(r => r.id === id);
            if (!record) {
                console.error('æœªæ‰¾åˆ°è®°å½•:', id);
                return;
            }
            
            console.log('æ‰¾åˆ°è®°å½•:', record);
            appState.currentRecord = record;
            
            // ç”ŸæˆæŠ½å±‰å†…å®¹
            const drawerBody = document.getElementById('drawerBody');
            drawerBody.innerHTML = `
                <div class="info-section">
                    <div class="info-title">åŸºæœ¬ä¿¡æ¯</div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">å‹å·</span>
                            <span class="info-value">${record.model}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ›²è½´ç¼–å·</span>
                            <span class="info-value">${record.shaftId}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ£€æµ‹è½®æ¬¡</span>
                            <span class="info-value">ç¬¬${record.round}è½®</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ£€æµ‹æ—¶é—´</span>
                            <span class="info-value">${record.datetime}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ“ä½œå‘˜</span>
                            <span class="info-value">${record.operator}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ•´ä½“åˆ¤å®š</span>
                            <span class="info-value">
                                <span class="badge ${record.result === 'åˆæ ¼' ? 'badge-success' : 'badge-danger'}">${record.result}</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-title">è·³åŠ¨é‡æ£€æµ‹ç»“æœ</div>
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>è½´é¢ˆç¼–å·</th>
                                <th>è·³åŠ¨é‡å€¼</th>
                                <th>åˆ¤å®š</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${record.vibrationData.map(item => `
                                <tr>
                                    <td>è½´é¢ˆ${item.id}</td>
                                    <td>${item.value}</td>
                                    <td><span class="badge ${item.result === 'åˆæ ¼' ? 'badge-success' : 'badge-danger'}">${item.result}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <div class="info-title">ç²—ç³™åº¦æ£€æµ‹ç»“æœ (Ra)</div>
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>è½´é¢ˆç¼–å·</th>
                                <th>Ra å€¼ (Î¼m)</th>
                                <th>åˆ¤å®š</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${record.roughnessData.map(item => `
                                <tr>
                                    <td>è½´é¢ˆ${item.id}</td>
                                    <td>${item.value}</td>
                                    <td><span class="badge ${item.result === 'åˆæ ¼' ? 'badge-success' : 'badge-danger'}">${item.result}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <div class="info-title">ç›´å¾„æ£€æµ‹ç»“æœ</div>
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>è½´é¢ˆç¼–å·</th>
                                <th>ä¼ æ„Ÿå™¨1</th>
                                <th>ä¼ æ„Ÿå™¨2</th>
                                <th>å·®å€¼</th>
                                <th>åˆ¤å®š</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${record.diameterData.map(item => `
                                <tr>
                                    <td>è½´é¢ˆ${item.id}</td>
                                    <td>${item.sensor1}</td>
                                    <td>${item.sensor2}</td>
                                    <td>${item.diff}</td>
                                    <td><span class="badge ${item.result === 'åˆæ ¼' ? 'badge-success' : 'badge-danger'}">${item.result}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            // æ˜¾ç¤ºæŠ½å±‰
            console.log('å‡†å¤‡æ˜¾ç¤ºæŠ½å±‰');
            const drawer = document.getElementById('detailDrawer');
            const overlay = document.getElementById('drawerOverlay');
            
            drawer.classList.add('show');
            overlay.classList.add('show');
            
            console.log('æŠ½å±‰å·²æ˜¾ç¤º, drawer.show:', drawer.classList.contains('show'));
            console.log('é®ç½©å·²æ˜¾ç¤º, overlay.show:', overlay.classList.contains('show'));
        }

        function closeDrawer() {
            document.getElementById('detailDrawer').classList.remove('show');
            document.getElementById('drawerOverlay').classList.remove('show');
            appState.currentRecord = null;
        }

        // ==================== å¯¼å‡ºåŠŸèƒ½ ====================
        function exportRecord() {
            if (!appState.currentRecord) return;
            
            // æ˜¾ç¤ºå¯¼å‡ºå¼¹çª—ï¼ˆå•æ¡è®°å½•ï¼‰
            document.getElementById('exportRangeGroup').style.display = 'none';
            document.getElementById('exportInfo').style.display = 'none';
            updateFilenameExample();
            
            document.getElementById('exportModal').classList.add('show');
        }

        function batchExport() {
            const count = appState.selectedRecords.size;
            if (count === 0) return;
            
            // æ˜¾ç¤ºå¯¼å‡ºå¼¹çª—ï¼ˆæ‰¹é‡ï¼‰
            document.getElementById('exportRangeGroup').style.display = 'block';
            document.getElementById('rangeSelected').checked = true;
            document.getElementById('exportInfo').style.display = 'block';
            document.getElementById('exportInfoText').innerHTML = 
                `å·²é€‰ä¸­ <strong>${count}</strong> æ¡è®°å½•ï¼Œå°†æ‰¹é‡å¯¼å‡ºä¸ºç‹¬ç«‹æ–‡ä»¶`;
            
            updateFilenameExample();
            document.getElementById('exportModal').classList.add('show');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
            document.getElementById('exportPassword').value = '';
            document.getElementById('exportPassword').classList.remove('error');
            document.getElementById('exportPasswordError').classList.remove('show');
        }

        function updateFilenameExample() {
            const record = appState.currentRecord || appState.allRecords[0];
            const range = document.querySelector('input[name="exportRange"]:checked')?.value || 'current';
            const count = appState.selectedRecords.size;
            
            if (range === 'selected' && count > 1) {
                document.getElementById('filenameExample').textContent = 
                    `ç¤ºä¾‹ï¼š${record.model}_QZ0001_ç¬¬1è½®_20251112_100000.xlsx ... ï¼ˆå…±${count}ä¸ªæ–‡ä»¶ï¼‰`;
            } else {
                const datetime = record.datetime.replace(/[:\s-]/g, '').replace(/\//g, '');
                document.getElementById('filenameExample').textContent = 
                    `ç¤ºä¾‹ï¼š${record.model}_${record.shaftId}_ç¬¬${record.round}è½®_${datetime}.xlsx`;
            }
        }

        function selectDirectory() {
            const newDir = prompt('è¯·è¾“å…¥å¯¼å‡ºç›®å½•è·¯å¾„ï¼š', 'C:\\Users\\Public\\Documents\\æ›²è½´æ£€æµ‹æŠ¥è¡¨');
            if (newDir && newDir.trim()) {
                document.getElementById('exportDirectory').textContent = newDir.trim();
                showToast('âœ“ å¯¼å‡ºç›®å½•å·²æ›´æ–°', 'success');
            }
        }

        function confirmExport() {
            const password = document.getElementById('exportPassword').value.trim();
            const passwordInput = document.getElementById('exportPassword');
            const passwordError = document.getElementById('exportPasswordError');

            // æ¸…é™¤é”™è¯¯çŠ¶æ€
            passwordInput.classList.remove('error');
            passwordError.classList.remove('show');

            // éªŒè¯å¯†ç 
            if (!password) {
                passwordInput.classList.add('error');
                passwordError.textContent = 'è¯·è¾“å…¥å¯†ç ';
                passwordError.classList.add('show');
                return;
            }

            if (password.length < 4) {
                passwordInput.classList.add('error');
                passwordError.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                passwordError.classList.add('show');
                passwordInput.value = '';
                return;
            }

            // æ¨¡æ‹Ÿå¯¼å‡º
            setTimeout(() => {
                closeExportModal();
                
                const range = document.querySelector('input[name="exportRange"]:checked')?.value || 'current';
                let message = 'âœ“ å¯¼å‡ºæˆåŠŸï¼Œæœ¬æ¡è®°å½•æ ‡è®°ä¸ºå·²å¯¼å‡º';
                
                if (range === 'selected') {
                    message = `âœ“ æ‰¹é‡å¯¼å‡ºæˆåŠŸï¼Œ${appState.selectedRecords.size} æ¡è®°å½•å·²æ ‡è®°ä¸ºå·²å¯¼å‡º`;
                    // æ›´æ–°æ‰€æœ‰é€‰ä¸­è®°å½•çš„å¯¼å‡ºçŠ¶æ€
                    appState.selectedRecords.forEach(id => {
                        const record = appState.allRecords.find(r => r.id === id);
                        if (record) record.exported = 'å·²å¯¼å‡º';
                    });
                    appState.selectedRecords.clear();
                } else if (appState.currentRecord) {
                    // æ›´æ–°å½“å‰è®°å½•çš„å¯¼å‡ºçŠ¶æ€
                    appState.currentRecord.exported = 'å·²å¯¼å‡º';
                }
                
                renderTable();
                updateBatchButtons();
                showToast(message, 'success');
            }, 800);
        }

        // ==================== åˆ é™¤åŠŸèƒ½ ====================
        function openBatchDeleteModal() {
            const count = appState.selectedRecords.size;
            if (count === 0) return;
            
            document.getElementById('deleteCount').textContent = count;
            document.getElementById('batchDeleteModal').classList.add('show');
        }

        function closeBatchDeleteModal() {
            document.getElementById('batchDeleteModal').classList.remove('show');
            document.getElementById('deletePassword').value = '';
            document.getElementById('deletePassword').classList.remove('error');
            document.getElementById('deletePasswordError').classList.remove('show');
        }

        function confirmBatchDelete() {
            const password = document.getElementById('deletePassword').value.trim();
            const passwordInput = document.getElementById('deletePassword');
            const passwordError = document.getElementById('deletePasswordError');

            // æ¸…é™¤é”™è¯¯çŠ¶æ€
            passwordInput.classList.remove('error');
            passwordError.classList.remove('show');

            // éªŒè¯å¯†ç 
            if (!password) {
                passwordInput.classList.add('error');
                passwordError.textContent = 'è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ';
                passwordError.classList.add('show');
                return;
            }

            if (password !== 'admin123') { // æ¨¡æ‹Ÿå¯†ç éªŒè¯
                passwordInput.classList.add('error');
                passwordError.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                passwordError.classList.add('show');
                passwordInput.value = '';
                return;
            }

            // æ¨¡æ‹Ÿåˆ é™¤
            setTimeout(() => {
                const count = appState.selectedRecords.size;
                
                // åˆ é™¤é€‰ä¸­çš„è®°å½•
                appState.allRecords = appState.allRecords.filter(r => !appState.selectedRecords.has(r.id));
                appState.filteredRecords = appState.filteredRecords.filter(r => !appState.selectedRecords.has(r.id));
                appState.selectedRecords.clear();
                
                closeBatchDeleteModal();
                renderTable();
                updateBatchButtons();
                showToast(`âœ“ æˆåŠŸåˆ é™¤ ${count} æ¡è®°å½•`, 'success');
            }, 800);
        }

        function openDeleteRecordModal() {
            if (!appState.currentRecord) return;
            document.getElementById('deleteRecordModal').classList.add('show');
        }

        function closeDeleteRecordModal() {
            document.getElementById('deleteRecordModal').classList.remove('show');
            document.getElementById('singleDeletePassword').value = '';
            document.getElementById('singleDeletePassword').classList.remove('error');
            document.getElementById('singleDeletePasswordError').classList.remove('show');
        }

        function confirmDeleteRecord() {
            const password = document.getElementById('singleDeletePassword').value.trim();
            const passwordInput = document.getElementById('singleDeletePassword');
            const passwordError = document.getElementById('singleDeletePasswordError');

            // æ¸…é™¤é”™è¯¯çŠ¶æ€
            passwordInput.classList.remove('error');
            passwordError.classList.remove('show');

            // éªŒè¯å¯†ç 
            if (!password) {
                passwordInput.classList.add('error');
                passwordError.textContent = 'è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ';
                passwordError.classList.add('show');
                return;
            }

            if (password !== 'admin123') {
                passwordInput.classList.add('error');
                passwordError.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                passwordError.classList.add('show');
                passwordInput.value = '';
                return;
            }

            // æ¨¡æ‹Ÿåˆ é™¤
            setTimeout(() => {
                const id = appState.currentRecord.id;
                appState.allRecords = appState.allRecords.filter(r => r.id !== id);
                appState.filteredRecords = appState.filteredRecords.filter(r => r.id !== id);
                
                closeDeleteRecordModal();
                closeDrawer();
                renderTable();
                showToast('âœ“ è®°å½•å·²åˆ é™¤', 'success');
            }, 800);
        }

        // ==================== ç”¨æˆ·èœå• ====================
        function toggleUserDropdown(e) {
            if (e) e.stopPropagation();
            const dropdown = document.getElementById('userDropdown');
            const isShowing = dropdown.classList.contains('show');
            dropdown.classList.toggle('show');
            console.log('ä¸‹æ‹‰èœå•åˆ‡æ¢:', isShowing ? 'å…³é—­' : 'æ‰“å¼€');
        }

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', (e) => {
            const userInfo = document.querySelector('.user-info');
            const dropdown = document.getElementById('userDropdown');
            if (!userInfo.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        function openChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('show');
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.remove('show');
            document.getElementById('oldPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('changePasswordError').classList.remove('show');
        }

        function confirmChangePassword() {
            const oldPassword = document.getElementById('oldPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const errorMsg = document.getElementById('changePasswordError');

            errorMsg.classList.remove('show');

            if (!oldPassword || !newPassword || !confirmPassword) {
                errorMsg.textContent = 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ';
                errorMsg.classList.add('show');
                return;
            }

            if (newPassword !== confirmPassword) {
                errorMsg.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
                errorMsg.classList.add('show');
                return;
            }

            if (newPassword.length < 6) {
                errorMsg.textContent = 'æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½';
                errorMsg.classList.add('show');
                return;
            }

            // æ¨¡æ‹Ÿä¿®æ”¹å¯†ç 
            setTimeout(() => {
                closeChangePasswordModal();
                showToast('âœ“ å¯†ç ä¿®æ”¹æˆåŠŸ', 'success');
            }, 800);
        }

        function lockScreen() {
            showToast('â° å±å¹•å·²é”å®š', 'success');
            // å®é™…åº”ç”¨ä¸­åº”è·³è½¬åˆ°é”å±é¡µé¢
        }

        function openLogoutModal() {
            document.getElementById('logoutModal').classList.add('show');
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').classList.remove('show');
        }

        function confirmLogout() {
            // å®é™…åº”ç”¨ä¸­åº”æ¸…ç†ä¼šè¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ
            showToast('âœ“ å·²é€€å‡ºç™»å½•', 'success');
            setTimeout(() => {
                // window.location.href = 'P1_ç™»å½•é¡µ.html';
            }, 1000);
        }

        // ==================== è¿”å›åŠŸèƒ½ ====================
        function goBack() {
            console.log('è¿”å›é¦–é¡µæŒ‰é’®è¢«ç‚¹å‡»');
            const isAdmin = appState.userRole === 'admin';
            const targetPage = isAdmin ? 'é…ç½®é¡µ' : 'é¦–é¡µ';
            console.log(`å‡†å¤‡è¿”å›: ${targetPage}, å½“å‰è§’è‰²: ${appState.userRole}`);
            
            showToast(`âœ“ è¿”å›${targetPage}`, 'success');
            
            // å®é™…åº”ç”¨ä¸­åº”è·³è½¬åˆ°ç›¸åº”é¡µé¢
            setTimeout(() => {
                // window.location.href = isAdmin ? 'P6_ç®¡ç†å‘˜é…ç½®.html' : 'P2_æ“ä½œå‘˜é¦–é¡µ_æ–°å»ºæ£€æµ‹ä»»åŠ¡.html';
                console.log('å¦‚æœå¯ç”¨è·³è½¬ï¼Œå°†è·³è½¬åˆ°:', isAdmin ? 'P6_ç®¡ç†å‘˜é…ç½®.html' : 'P2_æ“ä½œå‘˜é¦–é¡µ_æ–°å»ºæ£€æµ‹ä»»åŠ¡.html');
            }, 500);
        }

        // ==================== æ—¶é—´æ›´æ–° ====================
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', { 
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('currentTime').textContent = timeStr;
        }

        // ==================== æç¤ºåŠŸèƒ½ ====================
        function showToast(message, type = 'success') {
            const toastId = type === 'success' ? 'successToast' : 'errorToast';
            const toast = document.getElementById(toastId);
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ==================== é”®ç›˜å¿«æ·é”® ====================
        document.addEventListener('keydown', (e) => {
            // ESC å…³é—­æ‰€æœ‰å¼¹çª—å’ŒæŠ½å±‰
            if (e.key === 'Escape') {
                closeExportModal();
                closeBatchDeleteModal();
                closeDeleteRecordModal();
                closeLogoutModal();
                closeChangePasswordModal();
                closeDrawer();
            }
        });

        // ==================== åˆ‡æ¢è§’è‰²ï¼ˆæ¼”ç¤ºç”¨ï¼‰====================
        function switchRole() {
            appState.userRole = appState.userRole === 'operator' ? 'admin' : 'operator';
            appState.selectedRecords.clear();
            updateUIForRole(appState.userRole);
            renderTable();
            showToast(`âœ“ å·²åˆ‡æ¢ä¸º${appState.userRole === 'admin' ? 'ç®¡ç†å‘˜' : 'æ“ä½œå‘˜'}æ¨¡å¼`, 'success');
        }

        // åŒå‡»é¡¶éƒ¨æ ‡é¢˜åˆ‡æ¢è§’è‰²ï¼ˆæ¼”ç¤ºç”¨ï¼‰
        document.querySelector('.top-bar-left').addEventListener('dblclick', switchRole);

        // ==================== é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– ====================
        window.addEventListener('load', init);
    </script>
</body>
</html>

